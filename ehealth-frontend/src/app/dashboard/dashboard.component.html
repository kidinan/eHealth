<div class="dashboard-container">
  <nav class="top-nav">
    <div class="logo">eHealth <span>Portal</span></div>
    <button class="btn-add" style="background:#f1f5f9; color:#475569;" (click)="auth.logout()">Logout</button>
  </nav>

  <main class="content" [class.shifted]="showForm">
    <div class="header-actions">
      <div class="title-group">
        <h1 style="margin:0;">Patient Records</h1>
        <p style="color:#64748b;">Total patients: {{total}}</p>
      </div>
      
      <div style="display:flex; gap:12px;">
        <select [(ngModel)]="limit" (change)="onLimitChange()" class="limit-select">
          <option [ngValue]="10">10 per page</option>
          <option [ngValue]="50">50 per page</option>
          <option [ngValue]="100">100 per page</option>
        </select>
        <button class="btn-add" (click)="isEditing = false; showForm = true">+ Register</button>
      </div>
    </div>

    <div class="search-section">
      <input type="text" placeholder="üîç Search by name..." (input)="onSearch($event)">
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Department</th>
            <th>DOB</th>
            <th>Email</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of patients; let i = index" (dblclick)="openEdit(p)">
            <td style="color:#94a3b8; font-weight:600;">{{ (page - 1) * limit + i + 1 }}</td>
            <td><strong>{{ p.name }}</strong></td>
            <td><span class="dept-tag">{{ p.department }}</span></td>
            <td>{{ p.dob }}</td>
            <td>{{ p.email }}</td>
            <td><button class="btn-delete" (click)="deletePatient(p.id, $event)">Delete</button></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination">
      <button class="page-btn" [disabled]="page === 1" (click)="move(-1)">
        ‚Üê Previous
      </button>
      
      <div class="page-num">
        {{page}}
      </div>
      
      <button class="page-btn" [disabled]="(page * limit) >= total" (click)="move(1)">
        Next ‚Üí
      </button>
    </div>
  </main>

  <div class="overlay" *ngIf="showForm" (click)="showForm = false"></div>

  <div class="side-panel" [class.open]="showForm">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
      <h2 style="margin:0;">{{ isEditing ? 'Edit' : 'Register' }}</h2>
      <button (click)="showForm = false" style="background:none; border:none; cursor:pointer; font-size:1.5rem;">‚úï</button>
    </div>

    <div style="display:flex; flex-direction:column; gap:15px;">
      <input [(ngModel)]="newP.name" placeholder="Full Name" style="padding:12px; border-radius:10px; border:1px solid #e2e8f0;">
      <input [(ngModel)]="newP.email" placeholder="Email" style="padding:12px; border-radius:10px; border:1px solid #e2e8f0;">
      <input [(ngModel)]="newP.dob" type="date" style="padding:12px; border-radius:10px; border:1px solid #e2e8f0;">
      <select [(ngModel)]="newP.department" style="padding:12px; border-radius:10px; border:1px solid #e2e8f0;">
        <option value="General">General</option>
        <option value="Cardiology">Cardiology</option>
      </select>
      <button (click)="save()" class="btn-add" style="padding:15px; margin-top:10px;">{{ isEditing ? 'Update' : 'Save' }}</button>
    </div>
  </div>

  <app-chatbot></app-chatbot>
</div>